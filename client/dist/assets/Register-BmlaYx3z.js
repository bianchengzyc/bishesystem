import{u as R,r as c,a as x,c as C,b as w,d as o,w as s,e as n,f as k,o as E,g as _,E as m}from"./index-B6SUqF8J.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={class:"register-container"},B={class:"register-form-wrapper"},N={__name:"Register",setup(S){const p=k(),b=R(),i=c(),u=c(!1),r=x({username:"",password:"",confirmPassword:"",role:"admin"}),v={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(l,e,a)=>{e===""?a(new Error("请再次输入密码")):e!==r.password?a(new Error("两次输入密码不一致")):a()},trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]},V=async()=>{if(i.value)try{await i.value.validate(),u.value=!0;const l=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.token}`},body:JSON.stringify({username:r.username,password:r.password,role:r.role})}),e=await l.json();l.ok?(m.success(`用户 "${r.username}" 添加成功！`),r.username="",r.password="",r.confirmPassword="",r.role="admin",setTimeout(()=>{p.push("/login")},1500)):m.error(e.message||"添加用户失败")}catch(l){console.error("Register error:",l),m.error("添加用户失败，请检查网络连接")}finally{u.value=!1}},y=()=>{p.push("/login")};return(l,e)=>{const a=n("el-input"),d=n("el-form-item"),g=n("el-option"),h=n("el-select"),f=n("el-button"),P=n("el-form");return E(),C("div",q,[w("div",B,[e[6]||(e[6]=w("h2",null,"添加新账号",-1)),o(P,{model:r,rules:v,ref_key:"registerFormRef",ref:i,"label-width":"80px",class:"register-form"},{default:s(()=>[o(d,{label:"用户名",prop:"username"},{default:s(()=>[o(a,{modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=t=>r.username=t),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),o(d,{label:"密码",prop:"password"},{default:s(()=>[o(a,{modelValue:r.password,"onUpdate:modelValue":e[1]||(e[1]=t=>r.password=t),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),o(d,{label:"确认密码",prop:"confirmPassword"},{default:s(()=>[o(a,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=t=>r.confirmPassword=t),type:"password",placeholder:"请再次输入密码","show-password":""},null,8,["modelValue"])]),_:1}),o(d,{label:"角色",prop:"role"},{default:s(()=>[o(h,{modelValue:r.role,"onUpdate:modelValue":e[3]||(e[3]=t=>r.role=t),placeholder:"请选择角色"},{default:s(()=>[o(g,{label:"管理员",value:"admin"}),o(g,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1}),o(d,null,{default:s(()=>[o(f,{type:"primary",class:"register-button",onClick:V,loading:u.value},{default:s(()=>[...e[4]||(e[4]=[_(" 添加用户 ",-1)])]),_:1},8,["loading"]),o(f,{onClick:y},{default:s(()=>[...e[5]||(e[5]=[_("返回登录",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])])}}},A=T(N,[["__scopeId","data-v-35da8996"]]);export{A as default};
